<!DOCTYPE html>
<html>
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>GNU sed의 이상한 정규식 처리 - 홍가뤼의 개인위키</title>

    <meta name="description" content="제목과 관련된 내용이 15% 정도만 있는 이상한 페이지">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://honggaruy.github.io/wiki/sed-problem-solving/">
    <link rel="alternate" type="application/rss+xml" title="홍가뤼의 개인위키" href="https://honggaruy.github.io/feed.xml">

    <meta property="og:type" content="website">
    <meta property="og:title" content="GNU sed의 이상한 정규식 처리">
    <meta property="og:description" content="제목과 관련된 내용이 15% 정도만 있는 이상한 페이지">
    <meta property="og:image" content="https://honggaruy.github.io/resources/icon/apple-touch-icon.png">
    <meta property="og:url" content="https://honggaruy.github.io/wiki/sed-problem-solving/">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:url" content="https://honggaruy.github.io/wiki/sed-problem-solving/">
    <meta name="twitter:title" content="GNU sed의 이상한 정규식 처리">
    <meta name="twitter:description" content="제목과 관련된 내용이 15% 정도만 있는 이상한 페이지">

    <link rel="apple-touch-icon" sizes="180x180" href="/resources/icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/icon/favicon-16x16.png">
    <link rel="manifest" href="/resources/icon/site.webmanifest">




</head>
<body>
<header class="header">
    <div>
        <a class="site-title" href="/">홍가뤼의 개인위키</a>
    </div>
    <div>
        <a class="site-title-right" href="/about/">me</a>
    </div>
    <div>
        <a class="site-title-right" href="/wiki/index/#random" onclick="if(typeof random === 'function')random()">random</a>
    </div>
    <div>
        <a class="site-title-right" href="/blog/">blog</a>
    </div>
    <div>
        <a class="site-title-right" href="/wiki/index/">wiki</a>
    </div>
</header>

    
        <div class="page-content">
            <div class="search">
    <form role="search" method="get" action="/search/">
         <input name="searchString" class="searchInput" placeholder=" 검색하세요" type="text">
         <input type="submit" class="searchButton" value="Search">
    </form>
</div>
            <div class="post">
                
<input type="hidden" id="thisName" value="sed-problem-solving">
<div class="post">
    <header class="post-header">
        <h1 class="post-title">GNU sed의 이상한 정규식 처리</h1>
    
        <p class="title-summary">제목과 관련된 내용이 15% 정도만 있는 이상한 페이지</p>
    
        <div class="history-button">
            <p><a href="https://github.com/honggaruy/honggaruy.github.io/blame/master/_wiki/sed-problem-solving.md" target="_blank">created: 2020.04.07</a></p>
            <p><a href="https://github.com/honggaruy/honggaruy.github.io/blame/master/_wiki/sed-problem-solving.md" target="_blank">updated: 2020.04.14</a></p>
            <p>
                <a href="https://github.com/honggaruy/honggaruy.github.io/edit/master/_wiki/sed-problem-solving.md">편집하기</a>
                
                /
                <a href="https://github.com/honggaruy/honggaruy.github.io/issues/new?title=GNU+sed%EC%9D%98+%EC%9D%B4%EC%83%81%ED%95%9C+%EC%A0%95%EA%B7%9C%EC%8B%9D+%EC%B2%98%EB%A6%AC&amp;body=%EC%9D%98%EA%B2%AC%EC%9D%84%20%EB%82%A8%EA%B2%A8%EC%A3%BC%EC%84%B8%EC%9A%94">의견 남기기</a>
                
            </p>
        </div>
        <div id="parent-list"></div>


    <div class="post-tag">
    linux  sed  shell  regex
</div>




    </header>
    <article class="post-content">
        <ul id="markdown-toc">
  <li><a href="#1-%EB%B0%9C%EB%8B%A8" id="markdown-toc-1-발단">1. 발단</a></li>
  <li>
<a href="#2-%EC%A0%84%EA%B0%9C" id="markdown-toc-2-전개">2. 전개</a>    <ul>
      <li>
<a href="#%EC%B2%98%EC%9D%8C%EC%97%94--git-for-windows-%EC%9D%98-bash" id="markdown-toc-처음엔--git-for-windows-의-bash">처음엔 … git for windows 의 bash</a>        <ul>
          <li><a href="#%EA%B0%91%EC%9E%91%EC%8A%A4%EB%9F%B0-%EA%B8%89%EC%A0%84%EA%B0%9C" id="markdown-toc-갑작스런-급전개">갑작스런 급전개</a></li>
          <li><a href="#git-for-windows%EC%9D%98-bash-%EC%89%98%EC%97%90%EC%84%9C-%EC%8B%9C%EC%9E%91" id="markdown-toc-git-for-windows의-bash-쉘에서-시작">git for windows의 bash 쉘에서 시작</a></li>
          <li><a href="#johngrib%EB%8B%98%EC%9D%98-%EB%91%90%EB%B2%88%EC%A7%B8-%EB%8B%B5%EB%B3%80" id="markdown-toc-johngrib님의-두번째-답변">johngrib님의 두번째 답변</a></li>
        </ul>
      </li>
      <li>
<a href="#wsl-windows-subsystem-for-linux%EC%97%90-%EC%A0%95%EC%B0%A9%ED%95%98%EB%8B%A4" id="markdown-toc-wsl-windows-subsystem-for-linux에-정착하다">WSL (Windows Subsystem for Linux)에 정착하다</a>        <ul>
          <li><a href="#wsl%EC%9D%84-%EC%B2%98%EC%9D%8C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" id="markdown-toc-wsl을-처음-사용하기">WSL을 처음 사용하기</a></li>
          <li>
<a href="#sed%EC%9D%98-%EC%9C%84%ED%97%98%EC%84%B1%EC%97%90-%EB%8C%80%ED%95%9C-%EB%8C%80%EB%B9%84" id="markdown-toc-sed의-위험성에-대한-대비">sed의 위험성에 대한 대비</a>            <ul>
              <li><a href="#%EC%9C%84-%EB%B0%A9%EB%B2%95%EC%9D%84-%EA%B5%AC%EA%B8%80%EB%A7%81-%ED%95%98%EB%8B%A4%EA%B0%80-%EC%96%BB%EC%96%B4%EA%B1%B8%EB%A6%B0-%EB%82%B4%EC%9A%A9%EB%93%A4-%EC%A0%95%EB%A6%AC" id="markdown-toc-위-방법을-구글링-하다가-얻어걸린-내용들-정리">위 방법을 구글링 하다가 얻어걸린 내용들 정리</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
<a href="#%EB%93%9C%EB%94%94%EC%96%B4-%EC%A0%9C%EB%AA%A9%EA%B3%BC-%EA%B4%80%EB%A0%A8%EB%90%9C-%EB%82%B4%EC%9A%A9%EC%9C%BC%EB%A1%9C-" id="markdown-toc-드디어-제목과-관련된-내용으로-">드디어 제목과 관련된 내용으로 …</a>        <ul>
          <li><a href="#%EB%B3%B8%EB%9E%98-%EB%AC%B8%EC%A0%9C%EB%8A%94-%ED%92%80%EB%A0%B8%EC%A7%80%EB%A7%8C--%ED%92%80%EB%A6%AC%EC%A7%80-%EC%95%8A%EC%9D%80-%EC%9D%98%EB%AC%B8-%ED%95%98%EB%82%98" id="markdown-toc-본래-문제는-풀렸지만--풀리지-않은-의문-하나">본래 문제는 풀렸지만 … 풀리지 않은 의문 하나.</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<a href="#3-%EA%B2%B0%EB%A1%A0" id="markdown-toc-3-결론">3. 결론</a>    <ul>
      <li><a href="#%EC%95%84%EB%9E%98%EB%8A%94-%EB%8C%93%EA%B8%80-%EB%82%B4%EC%9A%A9%EC%9D%B4%EB%8B%A4" id="markdown-toc-아래는-댓글-내용이다">아래는 댓글 내용이다.</a></li>
      <li><a href="#%EB%AD%90%EA%B0%80-%EC%9D%B4%EC%83%81%ED%95%9C-sed-%EC%A0%95%EA%B7%9C%EC%8B%9D%EC%9D%B4%EB%83%90" id="markdown-toc-뭐가-이상한-sed-정규식이냐">뭐가 이상한 sed 정규식이냐?</a></li>
    </ul>
  </li>
</ul>

<h1 id="1-발단">1. 발단</h1>

<ul>
  <li>생각의 속도로 위키를 작성하다보니 파일명이 제각각이다.
    <ul>
      <li>주로 vim으로 문서 작업을 하고 <code class="language-html highlighter-rouge">nerdtree</code>를 쓰는데 <code class="language-html highlighter-rouge">_wiki</code>아래 md파일중에서..
        <ul>
          <li>Category문서와 일반 콘텐츠 문서를 한 눈에 구분하고 싶었다.</li>
        </ul>
      </li>
      <li>카테고리문서는 Camelcase-category.md , 콘텐츠 문서는 소문자로 시작하는 contents-document.md로 하기로 생각</li>
    </ul>
  </li>
  <li>
<a href="https://johngrib.github.io/wiki/my-wiki#%ED%8C%8C%EC%9D%BC-%EC%9D%B4%EB%A6%84%EC%9D%84-%EB%B3%80%EA%B2%BD%ED%95%9C%EB%8B%A4">johngrib님이 알려주신 방법</a>대로 :VimwikiRenameLink 를 이용하여 열심히 파일명을 수정하다보니…
    <ul>
      <li>갑자기 문서 맨 위쪽에 잘 나오던 <code class="language-html highlighter-rouge">상위 문서</code>항목이 안보이는 것이다.</li>
      <li>이유는 아래와 같다.
        <ul>
          <li>
<code class="language-html highlighter-rouge">상위 문서</code> 항목은 각 문서 위쪽 메타데이터의 parent 항목을 참조하는데…</li>
          <li>:VimwikiRenameLink는 vimwiki상의 링크만 수정하기 때문에 …</li>
          <li>vimwiki링크 형식이 아닌 parent 항목은 해당명령과는 상관이 없고 …</li>
          <li>결국 실제 파일명과 parent 항목의 파일명이 틀려져 발생하는 문제였다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="2-전개">2. 전개</h1>

<h2 id="처음엔--git-for-windows-의-bash">처음엔 … git for windows 의 bash</h2>

<h3 id="갑작스런-급전개">갑작스런 급전개</h3>

<ul>
  <li>johngrib님께 문의를 드렸더니, <a href="https://johngrib.github.io/wiki/my-wiki/#vimwikirenamelink-%EA%B0%80-parent-%EC%97%90%EB%8A%94-%EC%9E%91%EB%8F%99%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EB%AC%B8%EC%A0%9C">답변과 함께 질문을 본문에 넣어주셨다.</a>
    <ul>
      <li>Windows 플랫폼을 주로 사용하는 내겐 이제 까마득한 쉘 스크립트의 세계로 다시 발을 들여놓게되었다.</li>
    </ul>
  </li>
  <li>답변을 주셨으니 테스트 해봐야 한다.
    <ul>
      <li><del>처음엔 git이라는게 참쉽게 배워질거라 그렇게 믿었었는데 그렇게 믿어…</del></li>
      <li>처음엔 최근 쉘스크립트를 쓰던 환경이 git for windows 에서 제공하는 간단한 bash 쉘뿐이여서 여기서 시작했다.</li>
      <li>어디선가 읽은 내용인데 git for windows가 bash 쉘상에서 실행되는 이유는..
        <ul>
          <li>git이 단일 프로그램이 아닌 여러가지 UNIX 상의 툴이 조합되어 만들어진 시스템이라서 …</li>
          <li>windows에서 command line으로 실행하기 위해선 bash 환경을 만들고 그 위에서 지원하는 것이 제일 간단한 방법이라…</li>
          <li>이미 그런 환경을 구현한 MSYS2를 채용해 구현했다고 본것 같다. (원본 링크는 잊어서 확인은 불가…)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="git-for-windows의-bash-쉘에서-시작">git for windows의 bash 쉘에서 시작</h3>

<ul>
  <li>어차피 vim에서 작성하고 서버에 올릴때 bash git으로 올리는 지라 여기서 해결가능하다면 금상첨화</li>
  <li>johngrib님 답변중에 있는 ‘ag’는 지원되지 않는다. 리눅스상이라면 설치해서 해볼수 있을텐데
    <ul>
      <li>sudo install이나 apt-get 명령도 없어서 안됨</li>
    </ul>
  </li>
  <li>find 와 sed는 지원이 되어 해볼수 있었다. 여러가지 이슈가 발생하여 아래에 기록한다.
    <ol>
      <li>
<strong>sed 명령중  -i 옵션 뒤에 ‘’ 이 있고 없고의 차이</strong>
        <ul>
          <li>그대로 따라했더니 에러나옴, <code class="language-html highlighter-rouge">sed: can't read s,.....: No such file or directory</code>
</li>
          <li>-i 뒤에 문자열이 두개 있는데 첫번째 문자열이 이상해 지워봤더니 정상동작</li>
          <li>이게 typo인줄 알고 johngrib님께 문의해봤는데 그건 아님</li>
          <li>알고보니 <a href="https://www.grymoire.com/Unix/Sed.html#uh-62h">GNU sed와 BSD sed의 차이</a>
            <blockquote>
              <p>The GNU version of sed allows you to use “-i” without an argument. The FreeBSD/Mac OS X does not. You must provide an extension for the FreeBSD/Mac OS X version. IF you want to do in-palce editing without creating a backup, you can use</p>
              <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s/^/\t/'</span> <span class="k">*</span>.txt
</pre></td>
</tr></tbody></table></code></pre></div>              </div>
            </blockquote>
          </li>
          <li>결론적으로 내가 쓰는 GNU sed는 <code class="language-html highlighter-rouge">-i</code>만 쓰면 BSD sed의 <code class="language-html highlighter-rouge">-i ''</code> 와 같은 효과를 가진다.</li>
          <li>참고로.. -i 옵션은 <code class="language-html highlighter-rouge">in-place argument</code>라는 명칭을 가지는데, 여러개의 파일간에 유사한 simple 편집사항을 한방에 편집하는 옵션이다. 때문에 원본손실이 발생할수 있는데 이 -i 옵션에 suffix를 지정해 백업파일을 작성하도록 할수도 있다. (위 차이점 링크에 간단한 예제와 함께 설명이 되어있음)</li>
        </ul>
      </li>
      <li>
<strong>메타 데이터 <code class="language-html highlighter-rouge">parent</code> 작성시 일관성 문제</strong>
        <ul>
          <li>이런 건 <code class="language-html highlighter-rouge">parent : this-category $</code> 이렇게, 저런건 <code class="language-html highlighter-rouge">parent : that-category$</code> 저렇게.. ( 잘보면 trailing whitespace 의 차이가 있다. 차이를 부각시키려고 문장끝에 평소에는 안보이는 정규식의 문장끝 표시 <code class="language-html highlighter-rouge">$</code>를 추가했다.)</li>
          <li>..위와 같이 막 쓰다 보니 johngrib님이 제시해주신 정규식으로 category 이름을 정확히 포착하지 못하는 경우가 발생</li>
          <li>
<code class="language-html highlighter-rouge">trailing whtitespace</code>로 구글링해서 <a href="https://www.regular-expressions.info/examples.html">이 사이트</a>를 찾음</li>
          <li>사이트가 괜찮아보여 정규식 카테고리 만들고 [[regex-category]] 페이지에 등록</li>
          <li>해당 페이지 <code class="language-html highlighter-rouge">Trimming Whtitespace</code> 절에 <code class="language-html highlighter-rouge">trailing whitespace</code> 처리 방법대로 해봄
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre> <span class="c"># 현재 \[[ ]] 로 작성했지만 안보이는 상태임..</span>
 find <span class="nb">.</span> <span class="nt">-name</span> <span class="s1">'*.md'</span> | xargs <span class="nb">sed</span> <span class="nt">-E</span> <span class="nt">-i</span> <span class="s1">'s,(^parent *: *)([^\[]*)[ \t]+$,\1[[\2]],'</span> 
</pre></td>
</tr></tbody></table></code></pre></div>            </div>
          </li>
          <li>여전히 문제 발생</li>
          <li>이제는 <code class="language-html highlighter-rouge">category+공백+$</code>인 녀석들만 바뀌고 <code class="language-html highlighter-rouge">category+$</code>인 녀석들은 안바뀜</li>
          <li>두번에 나눠 작업하면 되긴 하지만 마음에 안듬</li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<h3 id="johngrib님의-두번째-답변">johngrib님의 두번째 답변</h3>
<ul>
  <li>기본적으로 trailing whitespace 만으로 처리하려는 것이 잘못된 생각임</li>
  <li>정규식에서 category title을 캡춰하는 두번째 캡춰에서 whitespace를 배제하는 것도 생각해야 했음
    <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="c"># 현재 \[[ ]] 로 작성했지만 안보이는 상태임..</span>
<span class="c"># johngrib님의 2번째 답변 내용</span>
find <span class="nb">.</span> <span class="nt">-name</span> <span class="s1">'*.md'</span> | xargs <span class="nb">sed</span> <span class="nt">-E</span> <span class="nt">-i</span> <span class="s1">'s,(^parent *: *)([^ \t\[]*) *$, \1\[[\2]],'</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>따라 해보니 한방에 잘되긴 한다.</li>
  <li>하지만 이것 저것 변형해 보고 싶은게 생겼고, 한계가 명확한 git for windwos의 bash를 떠나 자유를 꿈꾸며 WSL로 가기로 했다.</li>
</ul>

<h2 id="wsl-windows-subsystem-for-linux에-정착하다">WSL (Windows Subsystem for Linux)에 정착하다</h2>

<h3 id="wsl을-처음-사용하기">WSL을 처음 사용하기</h3>

<ul>
  <li>예전에 호기심으로 WSL을 설치해놓긴 했는데, 설치한후 한 번 돌려보고 이제 두번째정도 된다</li>
  <li>WSL 사용해보기 전에는 막연하게 windwos와 linux가 가상환경으로 완전 분리되지 않았을까 생각 했는데..</li>
  <li>윈도우에서 작성한 파일들을 linux의 강력한 도구들로 다룰수 있다 !!!!
    <ul>
      <li>윈도우와 리눅스는 file system 자체가 틀렸는데 파일 시스템은 윈도우를 쓰면서 linux의 도구를 사용할수 있게 한건가?</li>
      <li>이러한 의문들은 일단 <a href="https://webdir.tistory.com/540">요기</a>를 참고해보자</li>
      <li>리눅스로 윈도우에서 작성한 파일들을 손대는것은 되지만 역으로 가능하지는 않은듯하다.</li>
    </ul>
  </li>
  <li>일단 현재 사용목적으로는 git for windows의 bash 처럼 linux 도구를 사용하여 윈도우 파일들을 관리하는것으로 충분하다.</li>
</ul>

<h3 id="sed의-위험성에-대한-대비">sed의 위험성에 대한 대비</h3>

<ul>
  <li>필자 말로 Google rating이 상당히 좋고, 역사도 오래된 (1994년~) <a href="https://www.grymoire.com/Unix/Sed.html">이 문서</a>에 따르면…
    <ul>
      <li>sed 를 사용하는 대부분의 사용자는 <code class="language-html highlighter-rouge">s</code> 명령어만 쓰며 <code class="language-html highlighter-rouge">s</code> 명령어를 익히는데 필요한 90% 노력은 regex(Regular Expression)을 익히는데 든다고 한다</li>
      <li>가끔씩 쓸 때마다 다시 배우는 정규식이 주는 위협을 조금이라도 덜기 위해…수정하기전 이전 내용 백업이 필요한데..</li>
      <li>위에서 봤던 <a href="https://www.grymoire.com/Unix/Sed.html#uh-62h">이 링크</a>의 -i 옵션에 딸린 백업 기능을 쓸 필요가 있다.</li>
      <li>위 링크에서도 조심하기 위해 -i 옵션에 extension을 지정하기를 권장하고 있다.</li>
    </ul>
  </li>
  <li>백업 기능을 추가한 <code class="language-html highlighter-rouge">parent : category </code> 요소 변경하기
    <ol>
      <li>*.md 파일을 수정하고 백업 생성 (각 *.md별로 *.md.origin 생성하여 원본 백업)
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="c"># GUN version sed를 사용한다고 가정함</span>
find <span class="nb">.</span> <span class="nt">-name</span> <span class="s1">'*.md'</span> | xargs <span class="nb">sed</span> <span class="nt">-E</span> <span class="nt">-i</span>.origin <span class="s1">'s,(^parent *: *)([^ \t\[]*) *$,\1\[[\2]],'</span>
</pre></td>
</tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>*.md 파일과 *.md.origin 파일을 비교후 오류가 있으면 전부 원복 (원복시에 *.md.origin은 제거됨)
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="c"># rename 없으면 for 루프와 mv 명령으로 만들수도 있지만 rename이 훨씬 간단함. </span>
rename <span class="nt">-v</span> <span class="nt">-f</span> <span class="nt">-e</span> <span class="s1">'s/.md.origin/.md/'</span> <span class="k">*</span>.md.origin
</pre></td>
</tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>*.md 파일이 모두 정상적으로 변경되었으면 *.md.origin 제거
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nb">rm</span> <span class="k">*</span>.md.origin
</pre></td>
</tr></tbody></table></code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ul>

<h4 id="위-방법을-구글링-하다가-얻어걸린-내용들-정리">위 방법을 구글링 하다가 얻어걸린 내용들 정리</h4>

<ul>
  <li>for 루프와 mv 명령 == rename
    <ul>
      <li>누가 원조인지는 잘 모르겠지만 다음과 같이 비슷한 형식으로 linux rename 명령을 소개하는 글이 많다.
        <ol>
          <li>우선 mv로 파일명을 변경 하는 방법 소개
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nb">mv </span>oldfile.txt newfile.txt 
</pre></td>
</tr></tbody></table></code></pre></div>            </div>
          </li>
          <li>for와 mv를 써서 여러개의 파일명을 한번에 변경하는 방법 소개
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="c"># 대충 이런식? f와 *.prog는 다를수 있는데 형식은 모두 동일</span>
<span class="k">for </span>f <span class="k">in</span> <span class="k">*</span>.prog<span class="p">;</span> <span class="k">do </span><span class="nb">mv</span> <span class="nt">--</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">f</span><span class="p">%.prog</span><span class="k">}</span><span class="s2">.prg"</span>
</pre></td>
</tr></tbody></table></code></pre></div>            </div>
          </li>
          <li>위의 2번으로 했던 작업을 rename을 써서 간단하게 해결
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="c"># rename 사용법을 간단하게 소개하며 마무으리 </span>
rename <span class="s1">'s/.prog/.prg/'</span> <span class="k">*</span>.prog
</pre></td>
</tr></tbody></table></code></pre></div>            </div>
          </li>
        </ol>
      </li>
      <li>관련 자료들 링크 (핵심 내용은 서로 90% 정도 동일)
        <ul>
          <li><a href="https://www.howtogeek.com/423214/how-to-use-the-rename-command-on-linux/">How to Use the rename Command on Linux</a></li>
          <li><a href="https://linuxize.com/post/how-to-rename-files-in-linux/">How to Rename Files and Directories in Linux</a></li>
          <li><a href="https://www.webservertalk.com/rename-files-in-linux">Rename Files in Linux - MV, RENAME &amp; multiple Files at Once</a></li>
        </ul>
      </li>
      <li>rename 사용법은 대충 알겠는데 위에서 tricky한 방법으로 소개된 2번째 방식중…
        <ul>
          <li>mv 다음에 오는 <code class="language-html highlighter-rouge">--</code>의 의미를 도저히 알수가 없었다.</li>
          <li>알아 내기 위해 mv manual이나 for manual을 뒤졌는데 위와 같은 옵션은 적혀있질 않았다.</li>
          <li>
<a href="https://shoark7.github.io/programming/shell-programming/shell-expansions">shell 확장</a> 을 보다가…<a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">이곳</a>에 가봐도 없고..</li>
          <li>
<a href="https://jhnyang.tistory.com/154">요기</a>서는 “${f%.prog}.prg”의 의미는 알아낼수 있었다.
            <ul>
              <li>
<code class="language-html highlighter-rouge">${f%.prog}</code> 의 의미는 f로 지정된 파일명의 뒷부분에서 가장 짧게 일치하는 <code class="language-html highlighter-rouge">.prog</code>를 삭제하고 나머지를 반환..</li>
              <li>만약에 f가 <code class="language-html highlighter-rouge">something.prog</code>였다면 <code class="language-html highlighter-rouge">something</code>만 남겠네. 바로 뒤에 <code class="language-html highlighter-rouge">.prg</code>를 붙여서..</li>
              <li>
<code class="language-html highlighter-rouge">something.prog</code> –&gt; <code class="language-html highlighter-rouge">something.prg</code>가 되는 기법..</li>
            </ul>
          </li>
          <li>
<a href="http://throughkim.kr/2016/12/22/linux-5/">해석방법</a>, <a href="https://blog.gaerae.com/2015/01/bash-hello-world.html">핵심요약</a> 모두 좋은 내용이지만 찾는 내용은 없고…</li>
          <li>
<a href="https://wiki.kldp.org/HOWTO/html/Adv-Bash-Scr-HOWTO/index.html">전반적으로 소개하는 내용</a> 같아서 많이 뒤져봤는데 역시 못찾고..</li>
          <li>
<strong>아래는 알아내는데 시간이 좀 많이 걸린 <code class="language-html highlighter-rouge">--</code> 내용을 설명한다.</strong>
            <ul>
              <li>
<a href="https://mug896.github.io/bash-shell/basics.html#misc">BASH Shell Script중 2.Basics 뒷부분 Misc</a> 에서 <strong>드디어 발견!!!!</strong>
                <ul>
                  <li>
<code class="language-html highlighter-rouge">--</code>를 사용하여 <code class="language-html highlighter-rouge">이 뒤로부터는 옵션이 아니다</code> 라는 선언임</li>
                  <li>위 옵션이 필요한 경우는 grep으로 ‘-n’ 표현을 검색하고자 할 때 발생한다.
                    <ul>
                      <li>grep -r ‘-n’ 이라고 치면 ‘‘으로 둘러 쌌지만 -n을 옵션으로 인식하여 에러가 발생한다.
                        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-r</span> <span class="s1">'-n'</span>
Usage: <span class="nb">grep</span> <span class="o">[</span>OPTION]... PATTERN <span class="o">[</span>FILE]...
Try <span class="s1">'grep --help'</span> <span class="k">for </span>more information.
</pre></td>
</tr></tbody></table></code></pre></div>                        </div>
                      </li>
                      <li>grep -r – ‘-n’ 으로 다시치면 ‘-n’을 검색 대상으로 인식한다.
                        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-r</span> <span class="nt">--</span> <span class="s1">'-n'</span>
...검색결과를 보여줌...
</pre></td>
</tr></tbody></table></code></pre></div>                        </div>
                      </li>
                      <li>그러므로, <code class="language-html highlighter-rouge">mv -- "$f" "${f%.prog}.prg"</code> 는 단순히 <code class="language-html highlighter-rouge">mv oldfile newfile</code> 인데 파일명에서 옵션으로 오인할 여지를 없앤 내용임.</li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li>결국, StackExchange에서도 정확히 이 내용을 문의하는 <a href="https://unix.stackexchange.com/q/11376">질문</a> 발견 !!
                <ul>
                  <li>질문의 제목은 <code class="language-html highlighter-rouge">What does "--" (double-dash) mean?</code>
</li>
                  <li>영어 명칭은 <code class="language-html highlighter-rouge">end of command option</code> 인듯.</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="드디어-제목과-관련된-내용으로-">드디어 제목과 관련된 내용으로 …</h2>

<h3 id="본래-문제는-풀렸지만--풀리지-않은-의문-하나">본래 문제는 풀렸지만 … 풀리지 않은 의문 하나.</h3>

<ul>
  <li>regex101.com 사이트를 보다보니 <code class="language-html highlighter-rouge">\s</code>가 whitespace를 의미한다고 해서 [ \t]를 [\s]로 바꾸어 보았다.</li>
  <li>그러니까 find + sed 명령을 다음과 같이 바꿔보았다.
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="c"># 원래는 이랬던 명령어 조합을 ...</span>
find <span class="nb">.</span> <span class="nt">-name</span> <span class="s1">'*.md'</span> | xargs <span class="nb">sed</span> <span class="nt">-E</span> <span class="nt">-i</span>.origin <span class="s1">'s,(^parent *: *)([^ \t\[]*) *$,\1[[\2]],'</span>
<span class="c"># 이렇게 변경해 봤다 ... </span>
find <span class="nb">.</span> <span class="nt">-name</span> <span class="s1">'*.md'</span> | xargs <span class="nb">sed</span> <span class="nt">-E</span> <span class="nt">-i</span>.origin <span class="s1">'s,(^parent *: *)([^\s\[]*)\s*$,\1[[\2]],'</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>그랬더니 <code class="language-html highlighter-rouge">parent : \[[category ]]</code> 문제가 다시 발생했다. 아니 더 나빠졌다.</li>
  <li>어떤문서는 제대로 되고 어떤문서는 인식을 못한다 .. 되고, 안되는 규칙을 발견할 수 없었다.</li>
  <li>이번에는 johngrib님 에게서도 마땅한 답변을 얻지 못했다.</li>
  <li>믿을건 .. 언제나 답을 줬던 stack overflow 뿐.. 뒤져봤다</li>
</ul>

<h1 id="3-결론">3. 결론</h1>

<p>갑작스런 결론이지만 johngrib님 댓글창에 적은 답변을 이 페이지의 결론으로 하는게 좋을것 같았다.</p>

<h2 id="아래는-댓글-내용이다">아래는 댓글 내용이다.</h2>

<p>위 내용으로 stack overflow를 뒤지다가 해당 의문사항이 거의 풀려서 공유드립니다.</p>
<ul>
  <li>
<strong>의문사항 : GNU sed 정규식 에서 \s를 인식할때도 있고 인식하지 못할때도 있다. 규칙이 뭔가?</strong>
    <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="c"># 아래에서 \s가 세군데 사용되었는데 1,2번째는 인식하고 3번째는 인식못함</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'a : b '</span> | <span class="nb">sed</span> <span class="nt">-r</span> <span class="s1">'s,(a\s*:\s*)([^\s]*),\1[\2],'</span>
a : <span class="o">[</span>b <span class="o">]</span>
<span class="c"># 아래에서 3번째 \s를 ' '로 바꿀때 제대로 인식함 </span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'a : b '</span> | <span class="nb">sed</span> <span class="nt">-r</span> <span class="s1">'s,(a\s*:\s*)([^ ]*),\1[\2],'</span>
a : <span class="o">[</span>b]
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>답변 :
    <ul>
      <li>GNU sed는 POSIX 사양 호환으로 POSIX BRE(Basic Reqular Expression)을 지원 <a href="https://superuser.com/a/112837/1150566">참고한 링크</a>
</li>
      <li>
<a href="https://pubs.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap09.html#tag_09_03">POSIX BRE</a>중 <em>Braket Expression</em> (9.3.5)절에 [<em>list</em>] 일경우 list 내용에 대한 규칙이 나오는데…
        <ul>
          <li>
<em>list</em> 중에 있는 ‘.’, ‘*’,’[’,’' 문자는 특수 의미를 상실하고 literal의 의미만 가지게된다고 합니다.</li>
          <li>이 규칙 때문에 bracket 바깥에 있는 \s는 인식하지만 bracke안의 \s는 인식못함 ‘\’ ‘s’로 각각인식됩니다.</li>
          <li>따라서 bracket 내에서 특수 의미 문자 클래스를 사용하려면 별도의 규칙을 사용합니다.</li>
          <li>\s 대신 [:space:]를 사용해야하며 braket 내에서 사용할경우 [[:space:]] 혹은 [^[:space:]] 처럼 사용하게 됩니다.
            <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="c"># 규칙대로 사용한 의문사항 해결책</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'a : b '</span> | <span class="nb">sed</span> <span class="nt">-r</span> <span class="s1">'s,(a\s*:\s*)([^[:space:]]*),\1[\2],'</span>
a : <span class="o">[</span>b]
</pre></td>
</tr></tbody></table></code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<strong>2번째 의문사항 : 위의 규칙이 적용되었다면 [^\t]도 인식하지 못해야 하는데 왜 인식하나?</strong>
<img class="emoji" title=":exclamation:" alt=":exclamation:" raw="❗️" src="https://github.githubassets.com/images/icons/emoji/unicode/2757.png" style="vertical-align: middle; display: inline; max-width: 1em; visibility: hidden;" onload="this.style.visibility='visible'" onerror="this.replaceWith(this.getAttribute('raw'))"> 참고로 command line 상에서 \t문자를 입력하기 위해서는 <code class="language-html highlighter-rouge">Ctrl + 대문자 v</code>를 누르고 <code class="language-html highlighter-rouge">tab</code>을 누르면 됩니다. <a href="https://superuser.com/a/362250/1150566">참고링크</a>
</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="c"># [] 안의 \t 은 잘 인식함</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'a : b[탭문자]'</span> | <span class="nb">sed</span> <span class="nt">-E</span> <span class="s1">'s,(a\s*:\s*)([^\t]*)(\s*),\1[\2]_(\3),'</span>
a : <span class="o">[</span>b]_<span class="o">(</span>      <span class="o">)</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>
<ul>
  <li>답변
    <ul>
      <li>
<a href="https://www.gnu.org/software/sed/manual/sed.html#Character-Classes-and-Bracket-Expressions">GNU sed manaul의 5.5절</a> Character Classes and Bracket Expressions의 맨 마지막 부분에 이런 내용이 있습니다.
        <blockquote>
          <p>The characters $, <em>, ., [, and \ are normally not special within list. For example, [*] matches either ‘\’ or ‘</em>’, because the \ is not special here. However, strings like [.ch.], [=a=], and [:space:] are special within list and represent collating symbols, equivalence classes, and character classes, respectively, and [ is therefore special within list when it is followed by ., =, or :. <strong><u>Also, when not in POSIXLY_CORRECT mode, special escapes like \n and \t are recognized within list. See Escapes.</u></strong></p>
        </blockquote>
      </li>
      <li>편의성을 위해 POSIX 표준을 위반한 부분이 있는데 별도 옵션으로 엄격모드로 하지 않는한 \t는 bracket 내에서도 인식이 된다는 설명입니다.
이상입니다.</li>
    </ul>
  </li>
</ul>

<h2 id="뭐가-이상한-sed-정규식이냐">뭐가 이상한 sed 정규식이냐?</h2>

<ul>
  <li>문서를 보면 알겠지만, 그냥 결론 내용을 찾다가 알게된 많은 내용을 적고 싶었는데…</li>
  <li>마땅한 제목을 찾을수 없었다.</li>
  <li>그래서 그냥 최종적으로 정리한 내용을 제목으로 하기로 하고..</li>
  <li>어그로성 낚시성 제목을 달았다.</li>
  <li>어차피 나 혼자 보는 컨셉이므로 ..</li>
  <li>나만 잘 기억나면 된다.</li>
</ul>

    </article>


    
    <div class="post-comments">
    
    
        <script src="https://utteranc.es/client.js" repo="honggaruy/honggaruy.github.io" issue-term="pathname" label="Comment" theme="github-light" crossorigin="anonymous" async>
        </script>
    
    </div>




</div>
<script>
    ;(function() {
        var tags = document.querySelectorAll('.post-tag');
        if(tags == null || tags.length < 1) {
            return;
        }

        for (var i = 0; i < tags.length; i++) {
            var item = tags[i];
            var tagList = item.innerHTML.trim();

            if(/^\s*$/.test(tagList)) {
                continue;
            }
            tagList = tagList.split(/\s+/)
                .map(function(tag) {
                    return `<a href="/tag/#${tag}">#${tag}</a>`;
                })
                .join(' ');
            tags[i].innerHTML = tagList;
        }
        return;
    })();
    ;(function() {
        var post = document.querySelector('article.post-content');

        if(post == null) {
            return;
        }

        (function iterate_node(node) {

            if (/^(?:p|ul|h\d|table)$/i.test(node.tagName)) {

                node.innerHTML = link(node.innerHTML);

            } else { // Node.ELEMENT_NODE
                for (var i = 0; i < node.childNodes.length; i++) {
                    iterate_node(node.childNodes[i]);
                }
            }
        })(post);

        function link(content) {
            content = content.replace(/\\\[\[(.+?)\]\]/g, '\\[\\[$1\\]\\]');
            content = content.replace(/\[\[(.+?)\]\]\{(.+?)\}/g, '<a href="../$1">$2</a>');
            content = content.replace(/\[\[(.+?)\]\]/g, '<a href="../$1">$1</a>');
            content = content.replace(/\\\[\\\[(.+?)\\\]\\\]/g, '[[$1]]');
            return content;
        }

    })();
</script>


<script src="/js/axios.min.js"></script>
<script async src="/js/parent.js"></script>

            </div>
        </div>
        <footer class="footer">
    <div>

    </div>
</footer>
    
</body>
</html>
