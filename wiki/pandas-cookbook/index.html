<!DOCTYPE html>
<html>
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>pandas 쿡북 - 홍가뤼의 개인위키</title>

    <meta name="description" content="Chris Albon 과 비슷하게 적어보려고 함">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://honggaruy.github.io/wiki/pandas-cookbook/">
    <link rel="alternate" type="application/rss+xml" title="홍가뤼의 개인위키" href="https://honggaruy.github.io/feed.xml">

    <meta property="og:type" content="website">
    <meta property="og:title" content="pandas 쿡북">
    <meta property="og:description" content="Chris Albon 과 비슷하게 적어보려고 함">
    <meta property="og:image" content="https://honggaruy.github.io/resources/icon/apple-touch-icon.png">
    <meta property="og:url" content="https://honggaruy.github.io/wiki/pandas-cookbook/">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:url" content="https://honggaruy.github.io/wiki/pandas-cookbook/">
    <meta name="twitter:title" content="pandas 쿡북">
    <meta name="twitter:description" content="Chris Albon 과 비슷하게 적어보려고 함">

    <link rel="apple-touch-icon" sizes="180x180" href="/resources/icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/icon/favicon-16x16.png">
    <link rel="manifest" href="/resources/icon/site.webmanifest">




</head>
<body>
<header class="header">
    <div>
        <a class="site-title" href="/">홍가뤼의 개인위키</a>
    </div>
    <div>
        <a class="site-title-right" href="/about/">me</a>
    </div>
    <div>
        <a class="site-title-right" href="/wiki/index/#random" onclick="if(typeof random === 'function')random()">random</a>
    </div>
    <div>
        <a class="site-title-right" href="/blog/">blog</a>
    </div>
    <div>
        <a class="site-title-right" href="/wiki/index/">wiki</a>
    </div>
</header>

    
        <div class="page-content">
            <div class="search">
    <form role="search" method="get" action="/search/">
         <input name="searchString" class="searchInput" placeholder=" 검색하세요" type="text">
         <input type="submit" class="searchButton" value="Search">
    </form>
</div>
            <div class="post">
                
<input type="hidden" id="thisName" value="pandas-cookbook">
<div class="post">
    <header class="post-header">
        <h1 class="post-title">pandas 쿡북</h1>
    
        <p class="title-summary">Chris Albon 과 비슷하게 적어보려고 함</p>
    
        <div class="history-button">
            <p><a href="https://github.com/honggaruy/honggaruy.github.io/blame/master/_wiki/pandas-cookbook.md" target="_blank">created: 2021.07.15</a></p>
            <p><a href="https://github.com/honggaruy/honggaruy.github.io/blame/master/_wiki/pandas-cookbook.md" target="_blank">updated: 2022.12.01</a></p>
            <p>
                <a href="https://github.com/honggaruy/honggaruy.github.io/edit/master/_wiki/pandas-cookbook.md">편집하기</a>
                
                /
                <a href="https://github.com/honggaruy/honggaruy.github.io/issues/new?title=pandas+%EC%BF%A1%EB%B6%81&amp;body=%EC%9D%98%EA%B2%AC%EC%9D%84%20%EB%82%A8%EA%B2%A8%EC%A3%BC%EC%84%B8%EC%9A%94">의견 남기기</a>
                
            </p>
        </div>
        <div id="parent-list"></div>


    <div class="post-tag">
    pandas python
</div>




    </header>
    <article class="post-content">
        <ul id="markdown-toc">
  <li>
<a href="#tip1--dataframe-%EC%97%90%EC%84%9C-%EC%A4%91%EB%B3%B5%EB%90%98%EB%8A%94-data%EC%9D%98-unique%ED%95%9C-%EA%B0%92-%EB%AA%A9%EB%A1%9D%EC%9D%84-%EC%B6%94%EC%B6%9C%ED%95%A0-%EB%95%8C" id="markdown-toc-tip1--dataframe-에서-중복되는-data의-unique한-값-목록을-추출할-때">Tip1 : dataframe 에서 중복되는 data의 Unique한 값 목록을 추출할 때</a>    <ul>
      <li><a href="#%EC%8B%9C%EB%AE%AC%EB%A0%88%EC%9D%B4%EC%85%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%84%B8%ED%8A%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0" id="markdown-toc-시뮬레이션-데이터-세트-만들기">시뮬레이션 데이터 세트 만들기</a></li>
      <li><a href="#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9-%EC%A0%95%EB%A6%AC" id="markdown-toc-문제-상황-정리">문제 상황 정리</a></li>
      <li><a href="#%EB%B0%A9%EB%B2%95-%EB%B6%84%EC%84%9D" id="markdown-toc-방법-분석">방법 분석</a></li>
      <li><a href="#%EC%84%A0%ED%83%9D%EB%90%9C-%EB%B0%A9%EB%B2%95%EA%B3%BC-%EA%B2%B0%EA%B3%BC-%ED%99%95%EC%9D%B8" id="markdown-toc-선택된-방법과-결과-확인">선택된 방법과 결과 확인</a></li>
      <li>
<a href="#method-chaining-%EB%B6%84%EC%84%9D" id="markdown-toc-method-chaining-분석">Method Chaining 분석</a>        <ul>
          <li><a href="#dataframevalue_count" id="markdown-toc-dataframevalue_count">DataFrame.value_count()</a></li>
          <li><a href="#seriesreset_index" id="markdown-toc-seriesreset_index">Series.reset_index()</a></li>
          <li><a href="#dataframesort_values" id="markdown-toc-dataframesort_values">DataFrame.sort_values()</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="tip1--dataframe-에서-중복되는-data의-unique한-값-목록을-추출할-때">Tip1 : dataframe 에서 중복되는 data의 Unique한 값 목록을 추출할 때</h1>

<h2 id="시뮬레이션-데이터-세트-만들기">시뮬레이션 데이터 세트 만들기</h2>

<ul>
  <li>예를 들면, 다음과 같은 도서관 대출 목록 dataframe 이 있다고 하자</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td>
<td class="rouge-code"><pre><span class="c1"># 예제용 dataframe 만들기
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'제목'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Unity'</span><span class="p">,</span> <span class="s">'Rust'</span><span class="p">,</span> <span class="s">'Rust2'</span><span class="p">,</span> <span class="s">'Java'</span><span class="p">,</span> <span class="s">'Java1'</span><span class="p">,</span> <span class="s">'Java6'</span><span class="p">],</span>
            <span class="s">'대출기관'</span><span class="p">:</span> <span class="p">[</span><span class="s">'방배도서관'</span><span class="p">,</span> <span class="s">'방배도서관'</span><span class="p">,</span> <span class="s">'동작도서관'</span><span class="p">,</span> <span class="s">'동작도서관'</span><span class="p">,</span> <span class="s">'동작도서관'</span><span class="p">,</span> <span class="s">'동작도서관'</span><span class="p">],</span>
            <span class="s">'대여자'</span><span class="p">:</span> <span class="p">[</span><span class="s">'철수'</span><span class="p">,</span> <span class="s">'철수'</span><span class="p">,</span> <span class="s">'영희'</span><span class="p">,</span> <span class="s">'영희'</span><span class="p">,</span> <span class="s">'영희'</span><span class="p">,</span> <span class="s">'영희'</span><span class="p">],</span>
            <span class="s">'반납일'</span><span class="p">:</span> <span class="p">[</span><span class="s">'2022-09-15'</span><span class="p">,</span> <span class="s">'2022-09-15'</span><span class="p">,</span> <span class="s">'2022-09-15'</span><span class="p">,</span> <span class="s">'2022-10-01'</span><span class="p">,</span> <span class="s">'2022-10-01'</span><span class="p">,</span> <span class="s">'2022-10-03'</span><span class="p">],</span>
            <span class="p">}</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>인덱스</th>
      <th>제목</th>
      <th>대출기관</th>
      <th>대여자</th>
      <th>반납일</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>Unity</td>
      <td>방배도서관</td>
      <td>철수</td>
      <td>2022-09-15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Rust</td>
      <td>방배도서관</td>
      <td>철수</td>
      <td>2022-09-15</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Rust2</td>
      <td>동작도서관</td>
      <td>영희</td>
      <td>2022-09-15</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Java</td>
      <td>동작도서관</td>
      <td>영희</td>
      <td>2022-10-01</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Java1</td>
      <td>동작도서관</td>
      <td>영희</td>
      <td>2022-10-01</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Java6</td>
      <td>동작도서관</td>
      <td>영희</td>
      <td>2022-10-03</td>
    </tr>
  </tbody>
</table>

<h2 id="문제-상황-정리">문제 상황 정리</h2>

<ul>
  <li>도서 반납 일정을 짜기 위해 위의 도서관 대출 목록을 자료로 반납일을 출력하고 싶다</li>
  <li>즉, 중복되는 데이터가 존재하는 <code class="language-html highlighter-rouge">반납일</code> 열에서 (<code class="language-html highlighter-rouge">2022-09-15</code>, <code class="language-html highlighter-rouge">2022-10-01</code>, <code class="language-html highlighter-rouge">2022-10-03</code>) <em>Unique</em> 한 데이터가 3개 있다</li>
  <li>즉, <code class="language-html highlighter-rouge">반납일 목록</code>과 <code class="language-html highlighter-rouge">반납일에 가야하는 대출기관 목록</code>및 <code class="language-html highlighter-rouge">몇권을 반납해야는지</code>를 연계하여 출력하고 싶다</li>
  <li>한데 자세히 보니 <code class="language-html highlighter-rouge">2022-09-15</code>일 에는 도서관을 2군데(<code class="language-html highlighter-rouge">방배도서관</code>, <code class="language-html highlighter-rouge">동작도서관</code>) 가야 한다</li>
  <li>따라서, 위 데이터 세트에서  출력되어야 하는 데이터 형식은 다음과 같다
    <ul>
      <li>구체적으로 DataFrame 형식으로 출력하고 싶다</li>
    </ul>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: right">인덱스</th>
      <th style="text-align: right">반납일</th>
      <th style="text-align: right">대출기관</th>
      <th style="text-align: right">권수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0</td>
      <td style="text-align: right">2022-09-15</td>
      <td style="text-align: right">방배도서관</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2022-09-15</td>
      <td style="text-align: right">동작도서관</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2022-10-01</td>
      <td style="text-align: right">동작도서관</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">2022-10-03</td>
      <td style="text-align: right">동작도서관</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<h2 id="방법-분석">방법 분석</h2>

<ul>
  <li>우선, 제일먼저 생각나는 방법은 List 구조에서 중복 데이터를 제거하고 Unique한 값들을 추출하는 방법들이다
    <ul>
      <li>
<code class="language-html highlighter-rouge">파이썬 리스트 중복제거</code>로 찾아보면 여러가지가 있다. 아래는 한가지 예.
        <ul>
          <li><a href="https://jsikim1.tistory.com/214">Pythonn List 중복 제거 방법, 나를 위한것만은 아닌 기록</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>하지만, Pandas에서는 위의 방법보다 훨씬 간단한 방법이 있다
    <ul>
      <li><a href="https://chrisalbon.com/code/python/data_wrangling/pandas_find_unique_values/">Find Unique Values In Pandas Dataframes, chrisalbon.com</a></li>
      <li>이 방법을 적용해보면 결과는 다음과 같다
        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s">"반납일"</span><span class="p">].</span><span class="n">unique</span><span class="p">())</span>
<span class="c1"># ['2022-09-15', '2022-10-01', '2022-10-03']
</span></pre></td>
</tr></tbody></table></code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>그런데, 위 방법보다도 이 상황에 더 알맞은 다른 방법이 있다</li>
</ul>

<h2 id="선택된-방법과-결과-확인">선택된 방법과 결과 확인</h2>

<ul>
  <li>DataFrame의 method중에 Unique한 목록을 뽑아내는 용도로 <code class="language-html highlighter-rouge">value_counts</code>도 사용가능하다
    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
<td class="rouge-code"><pre><span class="n">df1</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s">'반납일'</span><span class="p">,</span> <span class="s">'대출기관'</span><span class="p">]].</span><span class="n">value_counts</span><span class="p">()</span>
<span class="s">""" print 출력
반납일      대출기관
2022-09-15  방배도서관    2
2022-10-01  동작도서관    2
2022-09-15  동작도서관    1
2022-10-03  동작도서관    1
dtype: int64 
"""</span>
<span class="n">df1</span><span class="p">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s">"반납일"</span><span class="p">,</span> <span class="s">"대출기관"</span><span class="p">])</span>
<span class="s">""" 
value_counts의 파라미터를 사용하면 df1을 사전에 가공할 필요가 없다
출력결과는 위와 동일하다
"""</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>응? 출력된 모습만 보면 이미 원하는 최종결과를 뽑아낸 것 같지만 착각이다
    <ul>
      <li>
<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.value_counts.html?highlight=value_counts#pandas.DataFrame.value_counts">value_counts api 문서</a>를 보면 결과값을 <code class="language-html highlighter-rouge">Series</code>로 반환한다</li>
      <li>위 문서에도 나와있지만, 반환된 <code class="language-html highlighter-rouge">Series</code> Object는 기본적으로 제공된 <code class="language-html highlighter-rouge">subset</code>으로 이루어진 <code class="language-html highlighter-rouge">MultiIndex</code>를 가진다</li>
      <li>즉, <code class="language-html highlighter-rouge">반납일</code>, <code class="language-html highlighter-rouge">대출기관</code> 부분이 인덱스이고 숫자를 센 부분이 <code class="language-html highlighter-rouge">value</code>이다</li>
    </ul>
  </li>
  <li>이 상태에서 우리가 원하는 최종 결과는 추가적인 method를 통해 다음과 같이 만들수 있다</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="n">df1_result</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s">'반납일'</span><span class="p">,</span> <span class="s">'대출기관'</span><span class="p">])</span>\
                <span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'권수'</span><span class="p">)</span>\
                <span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'반납일'</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="bp">True</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="s">""" df1_result 출력 결과
       반납일    대출기관  권수
0  2022-09-15  방배도서관     2
1  2022-09-15  동작도서관     1
2  2022-10-01  동작도서관     2
3  2022-10-03  동작도서관     1

** Line Continuation 사용시에 PEP 8 을 준수 하기 위해 `.` operator의 위치를 맞춘다
참조(https://peps.python.org/pep-0008/#should-a-line-break-before-or-after-a-binary-operator)
"""</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<h2 id="method-chaining-분석">Method Chaining 분석</h2>

<ul>
  <li>위의 <a href="https://en.wikipedia.org/wiki/Method_chaining">Method chaining</a> 에서 중요한 부분을 하나씩 알아보자</li>
  <li>버전별 차이가 다소 존재하므로 현재 사용하고 있는 버전의 매뉴얼을 참조하자 (아래 링크는 최신버전으로 걸어놓았다)
    <ul>
      <li>Pandas 버전 확인 방법
        <ul>
          <li>conda의 경우 : conda 환경에서 <code class="language-html highlighter-rouge">conda list pandas</code>
</li>
          <li>pip의 경우 : 가상환경에서 <code class="language-html highlighter-rouge">pip show pandas</code>
</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="dataframevalue_count"><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.value_counts.html">DataFrame.value_count()</a></h3>

<ul>
  <li>위에서 확인된 바와 갈이 DataFrame.value_count() 의 결과로 원하는 결과의 <code class="language-html highlighter-rouge">재료</code>가 이미 준비되었다</li>
  <li>subset 파라미터로 갯수를 계산할 고유한 조합 (Unique combinations)의 기준을 정한다</li>
  <li>결과는 Series로 반환 된다</li>
</ul>

<h3 id="seriesreset_index"><a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.reset_index.html">Series.reset_index()</a></h3>

<ul>
  <li>Series.reset_index() 로 MultiIndex부분을 일반적인 Column으로 변경한다</li>
  <li>name 파라미터로 Series의 Value 부분에 컬럼 이름을 줄 수 있다</li>
  <li>결과는 상황에 따라 Dataframe 혹은 Series로 반환된다. 위 경우에는 DataFrame 이다</li>
</ul>

<h3 id="dataframesort_values"><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sort_values.html">DataFrame.sort_values()</a></h3>

<ul>
  <li>가까운 날짜부터 차례로 정렬되는 것이 일정짜기에 좋으므로 <code class="language-html highlighter-rouge">반납일</code> 기준으로 배열한다</li>
  <li>정렬 기준이 여러개 일수 있으므로 <code class="language-html highlighter-rouge">by</code>, <code class="language-html highlighter-rouge">ascending</code>은 리스트를 받는다</li>
  <li>
<code class="language-html highlighter-rouge">ignore_index</code> 옵션으로 sort 이전의 기존 인덱스를 무시하고 정렬순으로 다시 0 부터 인덱스를 부여한다</li>
</ul>


    </article>


    
    <div class="post-comments">
    
    
        <script src="https://utteranc.es/client.js" repo="honggaruy/honggaruy.github.io" issue-term="pathname" label="Comment" theme="github-light" crossorigin="anonymous" async>
        </script>
    
    </div>




</div>
<script>
    ;(function() {
        var tags = document.querySelectorAll('.post-tag');
        if(tags == null || tags.length < 1) {
            return;
        }

        for (var i = 0; i < tags.length; i++) {
            var item = tags[i];
            var tagList = item.innerHTML.trim();

            if(/^\s*$/.test(tagList)) {
                continue;
            }
            tagList = tagList.split(/\s+/)
                .map(function(tag) {
                    return `<a href="/tag/#${tag}">#${tag}</a>`;
                })
                .join(' ');
            tags[i].innerHTML = tagList;
        }
        return;
    })();
    ;(function() {
        var post = document.querySelector('article.post-content');

        if(post == null) {
            return;
        }

        (function iterate_node(node) {

            if (/^(?:p|ul|h\d|table)$/i.test(node.tagName)) {

                node.innerHTML = link(node.innerHTML);

            } else { // Node.ELEMENT_NODE
                for (var i = 0; i < node.childNodes.length; i++) {
                    iterate_node(node.childNodes[i]);
                }
            }
        })(post);

        function link(content) {
            content = content.replace(/\\\[\[(.+?)\]\]/g, '\\[\\[$1\\]\\]');
            content = content.replace(/\[\[(.+?)\]\]\{(.+?)\}/g, '<a href="../$1">$2</a>');
            content = content.replace(/\[\[(.+?)\]\]/g, '<a href="../$1">$1</a>');
            content = content.replace(/\\\[\\\[(.+?)\\\]\\\]/g, '[[$1]]');
            return content;
        }

    })();
</script>


<script src="/js/axios.min.js"></script>
<script async src="/js/parent.js"></script>

            </div>
        </div>
        <footer class="footer">
    <div>

    </div>
</footer>
    
</body>
</html>
