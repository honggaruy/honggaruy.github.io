<!DOCTYPE html>
<html>
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>구글 스크립트 라이브러리 사용법 - 홍가뤼의 개인위키</title>

    <meta name="description" content="beyond battery-included, 추가배터리 구하기">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://honggaruy.github.io/wiki/gas_library/">
    <link rel="alternate" type="application/rss+xml" title="홍가뤼의 개인위키" href="https://honggaruy.github.io/feed.xml">

    <meta property="og:type" content="website">
    <meta property="og:title" content="구글 스크립트 라이브러리 사용법">
    <meta property="og:description" content="beyond battery-included, 추가배터리 구하기">
    <meta property="og:image" content="https://honggaruy.github.io/resources/icon/apple-touch-icon.png">
    <meta property="og:url" content="https://honggaruy.github.io/wiki/gas_library/">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:url" content="https://honggaruy.github.io/wiki/gas_library/">
    <meta name="twitter:title" content="구글 스크립트 라이브러리 사용법">
    <meta name="twitter:description" content="beyond battery-included, 추가배터리 구하기">

    <link rel="apple-touch-icon" sizes="180x180" href="/resources/icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/icon/favicon-16x16.png">
    <link rel="manifest" href="/resources/icon/site.webmanifest">




</head>
<body>
<header class="header">
    <div>
        <a class="site-title" href="/">홍가뤼의 개인위키</a>
    </div>
    <div>
        <a class="site-title-right" href="/about/">me</a>
    </div>
    <div>
        <a class="site-title-right" href="/wiki/index/#random" onclick="if(typeof random === 'function')random()">random</a>
    </div>
    <div>
        <a class="site-title-right" href="/blog/">blog</a>
    </div>
    <div>
        <a class="site-title-right" href="/wiki/index/">wiki</a>
    </div>
</header>

    
        <div class="page-content">
            <div class="search">
    <form role="search" method="get" action="/search/">
         <input name="searchString" class="searchInput" placeholder=" 검색하세요" type="text">
         <input type="submit" class="searchButton" value="Search">
    </form>
</div>
            <div class="post">
                
<input type="hidden" id="thisName" value="gas_library">
<div class="post">
    <header class="post-header">
        <h1 class="post-title">구글 스크립트 라이브러리 사용법</h1>
    
        <p class="title-summary">beyond battery-included, 추가배터리 구하기</p>
    
        <div class="history-button">
            <p><a href="https://github.com/honggaruy/honggaruy.github.io/blame/master/_wiki/gas_library.md" target="_blank">created: 2020.06.02</a></p>
            <p><a href="https://github.com/honggaruy/honggaruy.github.io/blame/master/_wiki/gas_library.md" target="_blank">updated: 2020.08.06</a></p>
            <p>
                <a href="https://github.com/honggaruy/honggaruy.github.io/edit/master/_wiki/gas_library.md">편집하기</a>
                
                /
                <a href="https://github.com/honggaruy/honggaruy.github.io/issues/new?title=%EA%B5%AC%EA%B8%80+%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8+%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC+%EC%82%AC%EC%9A%A9%EB%B2%95&amp;body=%EC%9D%98%EA%B2%AC%EC%9D%84%20%EB%82%A8%EA%B2%A8%EC%A3%BC%EC%84%B8%EC%9A%94">의견 남기기</a>
                
            </p>
        </div>
        <div id="parent-list"></div>


    <div class="post-tag">
    google-apps-script library
</div>




    </header>
    <article class="post-content">
        <ul id="markdown-toc">
  <li><a href="#1-%EA%B0%9C%EC%9A%94" id="markdown-toc-1-개요">1. 개요</a></li>
  <li>
<a href="#2-%EC%A0%84%EA%B0%9C" id="markdown-toc-2-전개">2. 전개</a>    <ul>
      <li><a href="#%EB%B0%B0%ED%8F%AC%EB%90%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%86%8C%EC%8A%A4%EC%BD%94%EB%93%9C-%EB%B3%B4%EB%8A%94-%EB%B0%A9%EB%B2%95%EC%9D%80-" id="markdown-toc-배포된-라이브러리-소스코드-보는-방법은-">배포된 라이브러리 소스코드 보는 방법은 ?</a></li>
      <li><a href="#%EB%B0%B0%ED%8F%AC%EB%90%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EC%9D%98-auto-completion-%EB%B0%A9%EB%B2%95%EC%9D%80-" id="markdown-toc-배포된-라이브러리의-auto-completion-방법은-">배포된 라이브러리의 auto completion 방법은 ?</a></li>
      <li><a href="#%EA%B8%B0%ED%83%80-%EC%A0%95%EB%B3%B4" id="markdown-toc-기타-정보">기타 정보</a></li>
    </ul>
  </li>
  <li>
<a href="#3-%EC%9D%BC%EB%B0%98-js-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%82%AC%EC%9A%A9%EB%A1%80" id="markdown-toc-3-일반-js-라이브러리-사용례">3. 일반 js 라이브러리 사용례</a>    <ul>
      <li>
<a href="#momentjs-%EB%A5%BC-google-apps-script%EC%9D%98-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EB%A1%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0" id="markdown-toc-momentjs-를-google-apps-script의-라이브러리로-만들기">moment.js 를 Google Apps Script의 라이브러리로 만들기</a>        <ul>
          <li><a href="#%EB%82%B4-%EA%B5%AC%EA%B8%80-%EB%93%9C%EB%9D%BC%EC%9D%B4%EB%B8%8C-%EC%83%81%EC%97%90-momentjs-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EB%93%B1%EB%A1%9D%EB%B0%A9%EB%B2%95" id="markdown-toc-내-구글-드라이브-상에-momentjs-라이브러리-등록방법">내 구글 드라이브 상에 moment.js 라이브러리 등록방법</a></li>
          <li><a href="#%EC%82%AC%EC%9A%A9%EB%B0%A9%EB%B2%95" id="markdown-toc-사용방법">사용방법</a></li>
        </ul>
      </li>
      <li>
<a href="#numeraljs-%EB%A5%BC-google-apps-script%EC%9D%98-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EB%A1%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0" id="markdown-toc-numeraljs-를-google-apps-script의-라이브러리로-만들기">numeral.js 를 Google Apps Script의 라이브러리로 만들기</a>        <ul>
          <li><a href="#%EB%93%B1%EB%A1%9D-%EB%B0%A9%EB%B2%95%EB%B0%8F-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95" id="markdown-toc-등록-방법및-사용-방법">등록 방법및 사용 방법</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="1-개요">1. 개요</h1>

<ul>
  <li>Google-Apps-Script 개발을 하다보니 로깅 시스템이 필요했다.</li>
  <li>
<a href="https://developers.google.com/apps-script/guides/logging">공식적인 관련 페이지</a>가 있어서 찾아보니…
    <blockquote>
      <p>These are described in the following sections. In addition to these mechanisms, you can also build your own logger code that, for example, writes information to a <strong>logging Spreadsheet</strong> or JDBC database.</p>
    </blockquote>
    <ul>
      <li>…구글 Spreadsheet에도 로깅을 할수 있다고 나온다. 그런데 어떻게 하면 되는지 자세히 나와있지는 않다.</li>
    </ul>
  </li>
  <li>위 페이지에서 나와있는 방법중에 stackdriver를 사용하는 방법도 나쁘지는 않지만…
    <ul>
      <li><a href="https://cloud.google.com/logging/quotas#logs_retention_periods">내가 원하는 기간만큼 보관되지는 않는것 같다.</a></li>
    </ul>
  </li>
  <li>구글링 해보니 <a href="https://github.com/peterherrmann/BetterLog">BetterLog</a> 라고 구글시트에 로그를 기록할 수 있는 개인이 만든듯한 라이브러리가 나온다.
    <ul>
      <li>설명에 나온대로 간단히 Library로 등록하고 생각한 대로 잘 동작한다.</li>
    </ul>
  </li>
  <li>github readme에 나온대로 Libraries..로 추가할 수 있는데 버전별로도 선택가능하고…, Open Source로 어떻게 등록하는지.. 궁금해졌다.</li>
  <li>
<a href="https://sites.google.com/site/scriptsexamples/custom-methods">Script Examples</a> : google apps script 코드 예제, 라이브러리등의 설명이 등록된 페이지 .. 일단 사이트주소가 ***.google.com이고, 이곳에 BetterLog도 등록되어 있다. pip 같은 곳인가??</li>
</ul>

<h1 id="2-전개">2. 전개</h1>

<ul>
  <li>찾아보니 .. Library로 배포하는 방법은 <a href="https://stackoverflow.com/a/28995046/9457247">요기</a>에 자세히 나와있다.</li>
  <li>Google Apps Script의 공식적인 설명은 <a href="https://developers.google.com/apps-script/guides/libraries">이 곳</a>
</li>
</ul>

<h2 id="배포된-라이브러리-소스코드-보는-방법은-">배포된 라이브러리 소스코드 보는 방법은 ?</h2>

<ul>
  <li>스택오버플로 질문 : <a href="https://stackoverflow.com/a/31997641/9457247">How can I view the souce of a google apps script Library ?</a>
</li>
  <li>라이브러리 배포시 project key로 배포하는데 그것만 알면 souce code를 위와 같은 방법으로 볼 수있다.</li>
</ul>

<h2 id="배포된-라이브러리의-auto-completion-방법은-">배포된 라이브러리의 auto completion 방법은 ?</h2>

<ul>
  <li>스택오버플로 질문 : <a href="https://stackoverflow.com/q/55015282/9457247">How do I get autocomplete to work in VSCode for 3rd Party libraries ?</a>
</li>
  <li>clasp으로 로컬에서 개발한다면, 일단 typesciprt , VS Code 환경이 일반적이다 (<a href="https://developers.google.com/apps-script/guides/typescript">공식적으로 지원되는 환경</a>이므로…)</li>
  <li>일단 그냥 되지는 않고.. “.d.ts” 파일을 만들거나, 해당 라이브러리를 복사해와서 쓸수 있는듯..</li>
  <li>해봤는데 잘 안되는듯… 마저 해보고 되는지 안되는지 여기 적을것.</li>
</ul>

<h2 id="기타-정보">기타 정보</h2>

<ul>
  <li>gas와 typescript 사용시 템플릿 ..<a href="https://github.com/iansan5653/gas-ts-template">github 위치</a>
</li>
  <li><a href="https://joshuatz.com/posts/2019/using-typescript-with-google-apps-script-and-google-ads-scripting/">Using TypeScript with Google Apps Script and Google Ads Scripting</a></li>
</ul>

<h1 id="3-일반-js-라이브러리-사용례">3. 일반 js 라이브러리 사용례</h1>

<h2 id="momentjs-를-google-apps-script의-라이브러리로-만들기">moment.js 를 Google Apps Script의 라이브러리로 만들기</h2>

<ul>
  <li>
<a href="https://momentjs.com/">moment.js</a> : javascript 빌트인 객체인 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a>는 쓰기 불편한데 쓰기좋게 만들어놓은 js 라이브러리</li>
  <li>
<a href="https://github.com/moment/moment/">moment.js 깃허브</a> : github star가 44.5k(2020-08-06 기준)인 많은 사람이 쓰는 라이브러리임</li>
</ul>

<h3 id="내-구글-드라이브-상에-momentjs-라이브러리-등록방법">내 구글 드라이브 상에 moment.js 라이브러리 등록방법</h3>

<ul>
  <li>이 작업으로 내 구글 드라이브 상 어느 프로젝트에서나 moment.js 라이브러리를 불러 쓸수 있다</li>
  <li>스크립트 ID를 공유할 경우 다른 사람도 쓸 수 있을것 같다. (아직 안해봄)</li>
</ul>

<ol>
  <li>moment.js 홈페이지에서 최신 버전을 다운받는다. ( 될수 있으면 moment-with-locales.js 버전을 다운받는게 좋을듯, 다국어지원을 위해)</li>
  <li>다운받은 파일 안에 .js 파일이 있을텐데 ..</li>
  <li>
<a href="https://script.google.com/home">Google Apps Script 홈</a> 에서 새 프로젝트 (standalone)를 하나 만들고 ..</li>
  <li>다운받은 .js 파일 내용을 복사해 넣는다. <strong>확장자는 반드시 .gs 로 해야한다</strong>
</li>
  <li>새 프로젝트 제목은 아무거나 해도 되는데 moment.js 라이브러리 인것을 알아볼수 있도록 해야한다.</li>
  <li>파일 &gt; 버전 관리 … 로 들어가서 설명을 적고 ( 라이브러리 버전은 적는게 좋을것이다) save 한다.</li>
  <li>1번 버전이 생성되었다.</li>
  <li>이후 라이브러리가 업데이트 된다면 .gs 파일 내용을 신규 라이브러리로 업데이트 하고 버전만 올리면된다.</li>
</ol>

<h3 id="사용방법">사용방법</h3>

<ul>
  <li>일단 clasp으로 로컬에서 typescript 로 개발하는 환경에서 사용방법을 알아본다.</li>
  <li>현재(2020-08-06) clasp을 이용한 로컬 typescript 개발환경에서는…</li>
  <li>
<a href="https://github.com/google/clasp/blob/master/docs/typescript.md#modules-exports-and-imports">module을 못쓰고</a> <a href="https://github.com/google/clasp/blob/master/docs/typescript.md#the-namespace-statement-workaround">namespace</a>로 여러 파일로 코드를 분산하여 개발할수 있다.</li>
  <li>아래 기술한 것은 하나의 사례일 뿐으로 꼭 그대로 해야한다는 것은 아니며 다른 방법이 있을 수 있다.</li>
</ul>

<ol>
  <li>
<a href="https://developers.google.com/apps-script/guides/libraries#managing_libraries">Google Script 라이브러리</a> 설명대로  위에 등록된 moment.js 라이브러리를 사용하려는 프로젝트에 등록한다.</li>
  <li>main.ts(entry 포인트?)에 Libaray namespace를 만들고 다음과 같이 작성한다.
    <div class="language-js highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="c1">// 아래에서 `Moment`는 앞단계에서 라이브러리 등록시 작성했던 식별자로 임의로 정해 사용한다.</span>
<span class="nx">namespace</span> <span class="nx">Library</span> <span class="p">{</span>
 <span class="k">export</span> <span class="kd">let</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">Moment</span><span class="p">.</span><span class="nx">moment</span><span class="p">;</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>위에서 <code class="language-html highlighter-rouge">Moment.moment</code>로 작성한 내용중 .moment는 moment.js 맨 처음에 global로 선언된 녀석으로 추측된다. 라이브러리 만드는 법좀 공부해 봐야겠다.
    <div class="language-js highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="c1">// moment-with-locales.gs 극 초반</span>
<span class="p">;(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">global</span><span class="p">,</span> <span class="nx">factory</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">typeof</span> <span class="nx">exports</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">module</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="p">?</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">()</span> <span class="p">:</span>
    <span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span> <span class="p">?</span> <span class="nx">define</span><span class="p">(</span><span class="nx">factory</span><span class="p">)</span> <span class="p">:</span>
    <span class="nb">global</span><span class="p">.</span><span class="nx">moment</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">()</span>  <span class="c1">// &lt;--- 이쪽의 .moment를 가져오는걸로 추측</span>
<span class="p">}(</span><span class="k">this</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>main.ts 에서 선언한 이후 sheets.ts 나 다른 파일에서 사용하기 위해선 다음과 같이 사용하면된다.
    <div class="language-js highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="c1">// moment.js의 Format Dates 기능을 사용 (홈페이지에서 첫번째 usage로 나옴)</span>
<span class="kd">let</span> <span class="nx">dateInString</span> <span class="o">=</span> <span class="nx">Library</span><span class="p">.</span><span class="nx">moment</span><span class="p">(</span><span class="nx">targetDate</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="dl">"</span><span class="s2">YYYY-MM-DD</span><span class="dl">"</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<h2 id="numeraljs-를-google-apps-script의-라이브러리로-만들기">numeral.js 를 Google Apps Script의 라이브러리로 만들기</h2>

<ul>
  <li>
<a href="https://numeraljs.com/">numeral.js</a> : javascript 빌트인 객체인 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Number">number</a>는 원하는 포맷의 string으로 바꾸거나 앞에 zero padding된 문자를 만들기 위해서는 간단한 목적에 비해 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat">쓸데없이 길게 코딩</a>해야하는데 그부분을 간단하게 해줄수 있는 라이브러리이다</li>
  <li>
<a href="https://github.com/adamwdraper/Numeral-js">numeal.js 깃허브</a> : github star가 8.3k(2020-08-06 기준)인 많은 사람이 쓰는 라이브러리임</li>
</ul>

<h3 id="등록-방법및-사용-방법">등록 방법및 사용 방법</h3>

<ul>
  <li>moment 가 numeral로 바뀐것 빼고 위의 moment.js 방법과 거의 99% 동일하다.</li>
  <li>홈페이지 제일 마지막 부분 <code class="language-html highlighter-rouge">#Acknowlegements</code>에 <code class="language-html highlighter-rouge">moment.js</code>에서 많이 베꼈다고 나와있어서 그런듯..</li>
  <li>근데 locales.js 파일이 분리되어 있다. ( moment.js는 moment-with-locaes.js로 붙여서 배포하는 버전도 있는데…)</li>
  <li>일단 라이브러리 등록시에 numeral 프로젝트 등록시 locales.js도 별도 파일로 등록은 했는데.. 사용할수 있을지는 써봐야할 듯..</li>
  <li>나중에 locale도 사용해보고 가능여부 이곳에 적을것…</li>
</ul>

    </article>


    
    <div class="post-comments">
    
    
        <script src="https://utteranc.es/client.js" repo="honggaruy/honggaruy.github.io" issue-term="pathname" label="Comment" theme="github-light" crossorigin="anonymous" async>
        </script>
    
    </div>




</div>
<script>
    ;(function() {
        var tags = document.querySelectorAll('.post-tag');
        if(tags == null || tags.length < 1) {
            return;
        }

        for (var i = 0; i < tags.length; i++) {
            var item = tags[i];
            var tagList = item.innerHTML.trim();

            if(/^\s*$/.test(tagList)) {
                continue;
            }
            tagList = tagList.split(/\s+/)
                .map(function(tag) {
                    return `<a href="/tag/#${tag}">#${tag}</a>`;
                })
                .join(' ');
            tags[i].innerHTML = tagList;
        }
        return;
    })();
    ;(function() {
        var post = document.querySelector('article.post-content');

        if(post == null) {
            return;
        }

        (function iterate_node(node) {

            if (/^(?:p|ul|h\d|table)$/i.test(node.tagName)) {

                node.innerHTML = link(node.innerHTML);

            } else { // Node.ELEMENT_NODE
                for (var i = 0; i < node.childNodes.length; i++) {
                    iterate_node(node.childNodes[i]);
                }
            }
        })(post);

        function link(content) {
            content = content.replace(/\\\[\[(.+?)\]\]/g, '\\[\\[$1\\]\\]');
            content = content.replace(/\[\[(.+?)\]\]\{(.+?)\}/g, '<a href="../$1">$2</a>');
            content = content.replace(/\[\[(.+?)\]\]/g, '<a href="../$1">$1</a>');
            content = content.replace(/\\\[\\\[(.+?)\\\]\\\]/g, '[[$1]]');
            return content;
        }

    })();
</script>


<script src="/js/axios.min.js"></script>
<script async src="/js/parent.js"></script>

            </div>
        </div>
        <footer class="footer">
    <div>

    </div>
</footer>
    
</body>
</html>
